# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении:

Товар

```
export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null; 
}
```
Данные покупателя

```
export interface ICustomer {
  paymentMethod: TPayment;
  deliveryAddress: string; 
  email: string; 
  phone: string;
}
```
Интерфейс для модели данных товаров

```
export interface IProductsData {
  products: TMainProductCardInfo[];
  preview: IProduct;
  selectProduct(item: IProduct): void;
}
```
Интерфейс для модели данных корзины
```
export interface IBasket {
  items: TBasketInfo[]; 
  totalAmount: number | null; 
  addItem: (product: IProduct) => void; 
  removeItem: (product: IProduct) => void; 
  getItemCount: () => number; 
  getTotalAmount: () => number; 
  clearBasket: () => void; 
}
```
Интерфейс для модели данных формы
```
export interface ICheckoutForm {
  paymentMethod: TPayment | null; 
  deliveryAddress: string; 
  email: string; 
  phone: string; 
  items: TBasketInfo[]; 
  totalAmount: number | null; 
  paymentAndAddressInfoValid(data: TPaymentFormInfo): boolean;
  contactInfoValid(data: TContactFormInfo): boolean;
  updatePaymentAndAddressInfo(
    field: keyof TPaymentFormInfo, 
    value: string | TPayment
  ): void;
  updateContactInfo(
    field: keyof TContactFormInfo, 
    value: string
  ): void;
  createOrderData(): object;
}
```

Данные способа оплаты

```
export type TPayment = 'cash' | 'card';
```
Данные карточки на главной странице

```
type TMainProductCardInfo = Pick<IProduct, 'id' | 'image' | 'title' | 'category' | 'price'>;
```
Данные карточки в корзине

```
type TBasketInfo = Pick<IProduct, 'title' | 'price'>;
```
Данные модального окно формы оплаты

```
type TPaymentFormInfo = Pick<ICustomer, 'paymentMethod' | 'deliveryAddress'>;
```
Данные модального окна формы контактов

```
type TContactFormInfo = Pick<ICustomer, 'email' | 'phone'>;
```

## Архитектура приложения:

Код приложения разделен на слои согласно парадигме MVP:
- Слой представления, отвечает за отображение данных на странице
- Слой данных, отвечает за хранение и изменение данных
- Презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
- `get` - выполняет `GET` запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие.
- `emit` - инициализация события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ProductCardsData

Класс отвечает за хранение и логику работы с данными карточек товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `_products: TMainProductCardInfo[]` - массив объектов карточек;
- `_preview: IProduct | null` - объект, представляющий выбранный товар;
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных;

Так же класс предоставляет набор методов для работы с этими данными:
- `selectProduct(item: IProduct): void` - выбирает карточку;
- `сеттеры` и `геттеры` для сохранения и получения данных из полей класса;

#### Класс BasketData

Класс отвечает за работу с данными в корзине.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `items: TBasketInfo[]` - массив объектов типа TBasketInfo, содержащий информацию о товарах в корзине. Каждый объект включает название товара и его цену; 
- `totalAmount: number | null` - хранит общую сумму всех товаров в корзине. Изначально может быть null, если корзина пуста; 
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных;

Так же класс предоставляет набор методов для работы с этими данными:
- `addItem(product: IProduct): void` - добавляет товар в корзину и добавляет его в массив `items`; 
- `removeItem(product: IProduct): void` - удаляет товар из корзины. Ищет и удаляет элемент в массиве `items`, соответствующий переданному товару.; 
- `getItemCount(): number` - возвращает количество товаров в корзине, равное длине массива items; 
- `getTotalAmount(): number` - вычисляет и возвращает общую стоимость товаров в корзине, суммируя цены всех элементов в массиве `items`; 
- `clearBasket(): void` - полностью очищает корзину, обнуляя массив `items` и сбрасывая totalAmount в null; 

#### Класс FormData

Класс отвечает за работу с данными в форме.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `paymentMethod: TPayment | null` - тип оплаты: наличные или карта, изначально null; 
- `deliveryAddress: string` - адрес доставки; 
- `email: string` - электронная почта пользователя; 
- `phone: string` - телефонный номер пользователя; 
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных;

Так же класс предоставляет набор методов для работы с этими данными:
- `paymentAndAddressInfoValid(data: TPaymentFormInfo): boolean` - проверяет, что способ оплаты и адрес доставки указаны корректно;
- `contactInfoValid(data: TContactFormInfo): boolean` - проверяет, что email и телефон введены в правильном формате;
- `updatePaymentAndAddressInfo(
    field: keyof TPaymentFormInfo, 
    value: string | TPayment
  ): void` - обновляет способ оплаты или адрес доставки в зависимости от переданного поля;
- `updateContactInfo(
    field: keyof TContactFormInfo, 
    value: string
  ): void` - обновляет электронную почту или телефон;
- `createOrderData(): object` - формирует объект с данными заказа: товары, итоговая сумма, контактные данные, способ оплаты и адрес доставки;

### Слой представления

Все классы представления отвечают за отображение внутри контейнера (DOM - элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
- `constructor(selector: string, events: IEvents)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для инициации событий.

Поля класса:
- `modal: HTMLElement` - элемент модального окна;
- `content: HTMLElement` — текущий контент модального окна;
- `events: IEvents` - брокер событий;

Методы класса:
- `setContent(content: HTMLElement): void` - устанавливает переданный элемент content в модальное окно и сохраняет новый контент в поле content;
 - `render(): void` - обновляет DOM внутри модального окна, отображая текущий контент, сохраненный в поле content;

#### Класс Card
Предоставляет универсальное решение для рендера карточек любого типа. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.
- `constructor(container: HTMLTemplateElement, events: IEvents)` - в конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. Помимо темплейта конструктор принимает экземпляр `EventEmitter` для инициации событий.\

Поля класса:
- `id: string` — идентификатор товара;
- `title: HTMLElement` — название товара;
- `description: HTMLElement` — описание товара;
- `category: HTMLElement` — категория товара;
- `image: HTMLImageElement` — изображение товара;
- `price: HTMLElement` — цена товара;
- `cardElement: HTMLElement` — корневой элемент карточки;
- `events: IEvents` — брокер событий;

Методы класса:
- `setData(cardData: IProduct): void` - заполняет атрибуты элементов карточки данными;
- `render(): HTMLElement` - рендерит содержимое карточки;
- геттер id возвращает уникальный id карточки;

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице.
- сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

#### Класс ModalBasket
Реализует модальное окно корзины для отображения добавленных товаров, их количества, общей стоимости, а также кнопки для удаления товара и оформление заказа.

Поля класса:
- `listContainer: HTMLElement` — контейнер для отображения списка товаров;
- `totalPriceElement: HTMLElement` — элемент для отображения общей стоимости товаров в корзинее;
- `events: IEvents` - брокер событий;

Методы класса:
- `setItems(items: TBasketInfo[]): void` - принимает коллекцию блоков разметки элементов списка и устанавливает эту коллекцию в контейнер;
- `checkout()` - оформляет заказ и очищает корзину;
- `renderItemCountIndicator()` - метод обновляет количество товаров в корзине, отображаемое на значке корзины в заголовке страницы;
- `render()` - генерирует HTML-код для отображения товаров в корзине, их цен и кнопок для удаления;

#### Класс ModalOrder
Реализует функциональность модального окна для оформления заказа. Оно предоставляет пользователю возможность выбора способа оплаты и ввода адреса доставки, а также управляет валидацией и изменением состояния кнопки "Далее" в зависимости от введённых данных.

Поля класса:
- `form: HTMLFormElement` - элемент формы;
- `submitButton: HTMLButtonElement` — кнопка "Далее" для продолжения оформления заказа;
- `paymentButtons: NodeListOf<HTMLElement>` — кнопки выбора способа оплаты;
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок;
- `events: IEvents` - брокер событий;

Методы класса:
- `selectPaymentMethod(method: string)` - обрабатывает выбор способа оплаты, визуально выделяет выбранный метод и сохраняет выбор;
- `validateForm()` - проверяет, заполнено ли поле адреса, и активирует или деактивирует кнопку "Далее" на основе результата;
- `handleSubmit()` - отправляет данные о способе оплаты и адресе доставки через брокер событий, инициируя дальнейший процесс заказа;
- `render()` - генерирует HTML-код формы;

#### Класс ModalPayment
Реализует функциональность модального окна для ввода данных пользователя (электронной почты и номера телефона) перед оплатой, а также управляет валидацией и изменением состояния кнопки "Оплатить" в зависимости от введённых данных.

Поля класса:
- `form: HTMLFormElement` - элемент формы;
- `emailInput: HTMLInputElement` — поле для ввода электронного адреса;
- `phoneInput: HTMLInputElement` — поле для ввода номера телефона;
- `submitButton: HTMLButtonElement` — кнопка "Оплатить";
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок;
- `events: IEvents` — брокер событий для взаимодействия с другими частями приложения;

Методы класса:
- `validateForm()` - проверяет, заполнено ли поле адреса, и активирует или деактивирует кнопку "Далее" на основе результата;
- `handleSubmit()` - отправляет данные о способе оплаты и адресе доставки через брокер событий, инициируя дальнейший процесс заказа;
- `render()` - генерирует HTML-код формы;

#### Класс ModalSuccess
Реализует функциональность модального окна успешной покупки. Constructor принимает шаблон и брокер событий.
Методы класса:
- `render()` - генерирует HTML-код модального окна завершения;

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:\
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `modalCardFull:open` - открытие модального окна с карточкой;
- `modalBasket:open` - открытие модального окна с корзиной;
- `card:select` - выбор карточки для корзины;
- `card:delete` - выбор карточки для удаления из корзины;
- `modalOrder:open` - открытие модального окна с вариантами оплаты и адресом;
- `payment:set` - выбор способа оплаты;
- `modalPayment:open` - открытие модального окна с контактами и завершением оплаты;
- `success:open` - открытие модального окна успешной оплатой;
- `success:close` - закрытие модального окна успешной оплаты;
- `order:input` - изменение данных в форме ввода адреса;
- `contacts:input` - изменение данных в форме ввода контактов;
- `order:submit` - сохранение данных адреса пользователя в модальном окне;
- `contacts:submit` - сохранение данных контактов пользователя в модальном окне;
- `order:validation` - событие, сообщающее о необходимости валидации формы адреса;
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактов;